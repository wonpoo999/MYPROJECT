-- (선택) 스키마 고정
-- ALTER SESSION SET CURRENT_SCHEMA = C##IDEV;

-- USERS
CREATE TABLE USERS (
  ID              NUMBER(19) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  USERNAME        VARCHAR2(100)  NOT NULL,
  EMAIL           VARCHAR2(190)  NOT NULL,
  PASSWORD        VARCHAR2(255)  NOT NULL,
  NAME            VARCHAR2(100)  NOT NULL,
  ROLE            VARCHAR2(20)   DEFAULT 'USER'    NOT NULL,
  GENDER          VARCHAR2(10)   DEFAULT 'FEMALE'  NOT NULL,
  HEIGHT_CM       NUMBER(10),
  WEIGHT_KG       NUMBER(10,2),
  PUBLIC_PROFILE  NUMBER(1)      DEFAULT 1         NOT NULL,
  TIER            VARCHAR2(10)   DEFAULT 'FREE'    NOT NULL,
  BORN_TOWN       VARCHAR2(100),
  LIVED_TOWN      VARCHAR2(100),
  MOTHER_NAME     VARCHAR2(100),
  DOG_NAME        VARCHAR2(100),
  ELEMENTARY      VARCHAR2(100)
);

-- 유니크 인덱스
CREATE UNIQUE INDEX UX_USERS_USERNAME ON USERS (USERNAME);
CREATE UNIQUE INDEX UX_USERS_EMAIL    ON USERS (EMAIL);

-- AVATAR (필수만) : user_id 1:1
CREATE TABLE AVATAR (
  ID       NUMBER(19) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  USER_ID  NUMBER(19) NOT NULL UNIQUE
);

ALTER TABLE AVATAR
  ADD CONSTRAINT FK_AVATAR_USER
  FOREIGN KEY (USER_ID) REFERENCES USERS(ID);

-- 확인
SELECT table_name FROM user_tables WHERE table_name IN ('USERS','AVATAR') ORDER BY table_name;

-- 시드 확인 (앱 실행 후에)
SELECT id, username, role FROM USERS WHERE UPPER(username) = 'ADMIN';

-- 기존 AVATAR 컬럼이 LEVEL이면
ALTER TABLE AVATAR RENAME COLUMN LEVEL TO LVL;
-- 기존 AVATAR 컬럼이 SIZE면
ALTER TABLE AVATAR RENAME COLUMN SIZE TO FILE_SIZE;
-- USER_ID 유니크 없으면
CREATE UNIQUE INDEX UK_AVATAR_USER ON AVATAR(USER_ID);
